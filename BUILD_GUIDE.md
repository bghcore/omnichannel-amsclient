# Build Guide

This package supports multiple build outputs for different distribution channels.

## NPM Package Build (Recommended)

For publishing to NPM registry:

```bash
npm run build
```

This uses **Vite** and outputs:
- `lib/index.cjs` - CommonJS bundle (for `require()`)
- `lib/index.mjs` - ES Module bundle (for `import`)
- `lib/index.d.ts` - TypeScript declarations

**Publish:** `npm publish`

## CDN Package Build (Legacy)

For deploying to blob storage as a CDN script:

### Step 1: Build with TypeScript Compiler

```bash
npm run build:tsc
```

This outputs individual `.js` files to `lib/` directory, required by esbuild.

### Step 2: Bundle for CDN

```bash
BASE_URL=https://[blob] SDK_VERSION=[version] node esbuild.config.js
```

Replace:
- `[blob]` - Your blob storage URL
- `[version]` - SDK version number

This creates:
- `dist/SDK.js` - Bundled SDK for CDN
- `dist/SDK.min.js` - Minified version
- `dist/iframe.js` - Iframe communicator
- `dist/iframe.html` - Iframe HTML

### Step 3: Deploy

Upload files from `dist/` to your whitelisted blob storage.

## Development

### Watch Mode (Vite)

```bash
npm run dev
```

Rebuilds on file changes.

### Testing

```bash
npm test
```

## Build Outputs Comparison

| Build Type | Command | Output | Use Case |
|------------|---------|--------|----------|
| **NPM (Vite)** | `npm run build` | `lib/*.cjs`, `lib/*.mjs` | NPM package distribution |
| **Legacy (TSC)** | `npm run build:tsc` | `lib/*.js` (individual files) | CDN builds, backward compatibility |

## Important Notes

- **For NPM publishing**: Use `npm run build` (Vite)
- **For CDN deployment**: Use `npm run build:tsc` then esbuild
- The esbuild config **requires** `lib/index.js` which is only generated by `build:tsc`
- Do not mix build commands - clean between builds: `npm run clean`
